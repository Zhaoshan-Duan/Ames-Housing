---
title: "Multiple Linear Regression on Ames Housing Data"
author: "Zhaoshan Duan"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  pdf_document:
    toc: yes
    number_sections: yes
    df_print: kable
    highlight: tango
    latex_engine: xelatex
  html_document:
    toc: yes
    df_print: paged
subtitle: Stat 632
header-includes: null
bibliography:
- packages.bib
- reference.bib
fontsize: 12pt
---

```{r include=FALSE}
source("./scripts/script.R")
source("./scripts/figure_generator.R")
knitr::opts_chunk$set(echo=FALSE, message=FALSE)
```

\newpage

# Abstract

This project uses the a dataset that describes residential property sales in Ames, Iowa between 2006 and 2021. The dataset contains 2970 observations and 81 variables describing nearly every aspect of a residential property. We are interested in investigating what fixed characteristics influence the sale price of a property in Ames, Iowa using multiple linear regression. Through various variable selection techniques, we reduced the amount of predictors in our model to 10. Although the model explains 81.6% of the variability in sale price, it is more likely that we are overfitting the model.

We concluded that in Ames, Iowa, a house is more valuable with bigger living area and better overall condition. Having a basement would decrease the home value according to our model. The fixed characteristics that influences the sale price of a house the most is the overall quality of the materials and finish, and the size of the living area.

We also find that multiple linear regression may not be the best regression model for this dataset since the normality assumption could not be improved. This finding agrees with the conventional regression model used for real state pricing - hedonic regression method, a variation of Lasso regression.

\newpage

# Problem and Motivation

## Background of the Dataset

This project uses the Ames Housing Dataset by Sean De Cock (2011), a contemporary alternative to the well known Boston Housing dataset. The dataset describes the sale of individual residential property in Ames, Iowa from 2006 to 2010. The original dataset contains 2930 observations and 82 explanatory variables (23 nominal, 23 ordinal, 14 discrete, and 20 continuous). Most of the explanatory variables are information that a home buyer typically sought out when purchasing properties.

The continuous numeric variables of the dataset describe the various area dimensions for each property and the discrete numeric variables quantify the number of typical items within the house such as amount of bedrooms. The nominal categorical variables identify types of dwellings, garages, materials and environmental conditions while ordinal categorical variables rate items within the property. [@Ames-Original]

## Motivation

For many people, homeownership is a both a dream and an achievement. It is a serious purchasing decision that requires meticulous research and careful Pro & Con analysis. Accurate prediction of housing prices provides great help in buyer's decision-making process and informs them what characteristics of the properties generally affect the prices. The same can be said for realtors, sellers and developers. Housing prices also reflect the health of the economy, which can be insightful for police makers.

While there are many external factors influencing the housing price of a given property such as crime rate in the region, proximity to public schools, hospitals and busy areas, fixed characteristics of the house are often the first things people look at. Therefore, we think it will be interesting to examine the sale price of the property using a multiple linear regression model with explanatory variables that contain information about many common aspects of the house such as number of bathrooms, size of the basement and so on. It would also be fascinating to observe the quantitative relationship between these characteristics and the sale price, and see which ones have the most influence as well as its implication to buyers' purchasing behavior.

\newpage

# Data Description

We use the `AmesHousing` package on CRAN to access the data. The package provides two version of the data: `ames_raw` and processed `ames`. Our preprocessing and analysis are done on the processed version as it removes unique identifiers such as `Order` and `PID` , arranges all factors unordered, and engineers features with large missing values. This results in a dataset with 2930 observations and 81 explanatory variables. Prior to analysis, we removed 168 observations since they are of non-residential types as indicated in the table below.

```{r property_type}
property_type_summary
```

The response variable is `Sale_Price` and our predictors and the description of the predictors in the final model are in listed in the Table 1.

| Variable Name           | Description                                                                   |
|-------------------------|-------------------------------------------------------------------------------|
| `Total_Area`            | Total area (including basement)                                               |
| `Total_Bsmt_SF`         | Total square feet of basement area                                            |
| `Garage_Area`           | Size of garage in square feet                                                 |
| `Overall_Qual_Good`     | Good overall material and finish of the house                                 |
| `Overall_Qual_Poor`     | Poor overall material and finish of the house                                 |
| `TotRms_AbvGrd_15`      | The number of total rooms above grade (does not include bathrooms) that is 15 |
| `Bsmt_Qual_Typical`     | Typical quality and height of the basement                                    |
| `Bsmt_Qual_Good`        | Good quality and height of the basement                                       |
| `Bsmt_Qual_No_Basement` | Property that does not have basement                                          |
| `Year_Built`            | The year the property was built                                               |

: Predictors in the Final Model

# Question of Interest

Our primary question of interest is to identify what fixed characteristics of a property has the largest effect on the sale price in Ames, Iowa. Secondarily, we are interested in knowing what types of a home would have lower market values in Ames, Iowa.

\newpage

# Exploratory Data Analysis

In this section, we investigate access the missingness of the dataset, create new variables that could help us answer our research question, examine summary statistics on the response variable, correlation between the numeric predictors. We also record features and observations that are removed from our analysis in this section.

## Missingness

We first investigate the missing values of the dataset using `DataExplorer` package. From Figure 1, it can be observed that all the missing values have been imputed to 0 since this project is using the processed version of the data.

```{r mssingness, fig.cap = "Missing Value in the Data Set", fig.dim=c(10,10)}
raw_ames %>% plot_missing(ggtheme = theme_tq())
```

This is somewhat misleading since some of the numerical variables have mostly 0 values as Figure 2 indicates. Hence, We remove the following numeric variables: `BsmtFin_SF_2`, `Enclosed_Porch`, `Low_Qual_Fin_SF`, `Misc_Val`, `Pool_Area`, `Screen_Porch`, `Three_season_porch`, `Bsmt_Half_Bath`, `Kitchen_AbvGr`, `Open_Porch_SF`

```{r numeric_plot, fig.cap="Numerical Variables Overview", fig.dim=c(9,9)}
numeric_plot 
```

Additionally, some of the categorical variables have majority of the data concentrated in one level as Figure 3 indicated. Therefore we remove the following categorical variables: `Utilities`, `Street`, `Alley`, `Roof_Matl`, `Land_Contour`, `Land_Slope`, `Condition_1`, `Condition_2`, `Heating`, `Functional`, `Pool_QC`, `Bsmt_Cond`, `Misc_Feature`, `Central_Air`, `Electrical`, `Garage_Qual`, `Garage_Cond`, `Paved_Drive`. We also remove `Longtitude` and `Latitude` as they are computationally expensive (each with 2700+ levels) and irrelevant to our research questions.

```{r fig.cap="Removable Categorical Variables", fig.dim=c(10,10)}
stack_plot_rm
```

\newpage

## Response Variable `Sale_Price`

We plot `Sale_Price` against `Gv_Liv_Area` [Above grade (ground) living area in square feet] since, base on intuition, size of the property may be positively associated with its value. We also plot the distribution of the response in a histogram and a box plot, check the normality of the response variable in normal Q-Q plot.

From Figure 4, we can observe a clear right skewness of the response which suggest some types of transformation should be considered to improve its normality. This is confirmed in Table 2 since the response has an observed mean of \$179,957.7 and an observed median of \$159,000. Overall, the response variable is heavily right skewed with some potentially influential data points.

```{r fig.cap="Summary Statistics of Sale_Price"}
stack_plot_response
```

| Statistics     | Values      |
|----------------|-------------|
| Mean           | \$179,957.7 |
| Median         | \$159,000   |
| Standard Error | 80,219      |

: Sale_Price Summary Statistics

We test out log transformation on the response. It is evident from the Figure 5 that the transformation has greatly improved the normality of the response. Therefore, we should consider applying log transformation on the response when we fit the model.

```{r fig.cap="Log Transformation on Sale_Price"}
stack_plot_transformed_response
```

Moreover, from the scatter plot in Figure 4, we can observe some exceedingly large data points. The author suggested to remove points that have general living area larger than 4000 sqft. We need to further investigate these points.

\newpage

## Numeric Predictors

We investigate the correlation between the predictors and the response in a correlation matrix (Figure 6). Some correlation between the predictors are intuitive such as `Gv_Liv_Area` is linear combination of `First_Flr_SF` and `Second_Flr_SF` as well as `Bedroom_AbvGr`.

```{r fig.cap="Correlation Matrix"}
gz
```

We further investigate muticollinearity with Variance Inflation Factor table below and found that, as expected, `Gr_Liv_Area`, `Firest_Flr_SF` and `Second_Flr_SF` all have VIF scores much larger than 5. We decided to remove `Firest_Flr_SF` and `Second_Flr_SF` and keep `Gr_Liv_Area` since it is contextually important. `Garage_Area` and `Garage_Cars` have VIF scores slightly above 5 as well. However, we decided to keep both variables and convert `Garage_Cars` to a factor.

```{r fig.cap="VIF Scores"}
vif_score
```

\newpage

# Regression Analysis, Results and Interpretation

## Feature Engineering

We create 4 new variables that could help us answer our research questions: `Total_Area` that combines general living area and basement area; `Price_Total_Per_Ft` calculates the sale price of the total property area per square feet; `Price_Liv_Per_Ft` calculates sale price of the living area per square feet; `Remodeled` that determines whether the house was remodeled.

## Variable Selection

Before fitting the model, we apply forward, backward and stepwsie variable selection algorithms to reduce the amount of variables we will use in the model. Since the computation takes considerable amount of time, we run the algorithms in a separate script, `model.R` and save the result in as an RDS object. From the RDS, we are left with 28 variables. We categorized them and list their types, descriptions in Table 3.

We further reduce the amount of variables and remove those that do not address our research questions. We remove the following variables from our analysis: `Mas_Vnr_Area`, `MS_Zoning`, `Garage_Cars`, `Fireplace_Qu`, `Neighborhood`, `Exterior_2nd`.

+----------------------+---------------+------------------------------------------------------------------------+-----------+
| Variable Name        | Variable Type | Description                                                            | Category  |
+======================+===============+========================================================================+===========+
| `Lot_Frontage`       | Numeric       | Linear feet of street connected to property                            |           |
+----------------------+---------------+------------------------------------------------------------------------+-----------+
| `Overall_Qual`       | Factor        | Rates the overall material and finish of the house                     |           |
+----------------------+---------------+------------------------------------------------------------------------+-----------+
| `Overall_Cond`       | Factor        | Rates the overall condition of the house                               |           |
+----------------------+---------------+------------------------------------------------------------------------+-----------+
| `TotRms_AbvGrd`      | Factor        | Total rooms above grade (does not include bathrooms)                   |           |
+----------------------+---------------+------------------------------------------------------------------------+-----------+
| `Bedroom_AbvGr`      | Factor        | Bedrooms above grade (does NOT include basement bedrooms)              |           |
+----------------------+---------------+------------------------------------------------------------------------+-----------+
| `Total_Area`         | Numeric       | Total area (including basement)                                        |           |
+----------------------+---------------+------------------------------------------------------------------------+-----------+
| `Price_Total_Per_Ft` | Numeric       | Sale price of the total property area per square feet                  |           |
+----------------------+---------------+------------------------------------------------------------------------+-----------+
| `Price_Liv_`         | Numeric       | sale price of the living area per square feet                          |           |
|                      |               |                                                                        |           |
| `Per_Ft`             |               |                                                                        |           |
+----------------------+---------------+------------------------------------------------------------------------+-----------+
| `Neighborhood`       | Factor        | Physical locations within Ames city limits                             |           |
+----------------------+---------------+------------------------------------------------------------------------+-----------+
| `MS_SubClass`        | Factor        | Identifies the type of dwelling involved in the sale.                  |           |
+----------------------+---------------+------------------------------------------------------------------------+-----------+
| `Lot_Shape`          | Factor        | General shape of property                                              |           |
+----------------------+---------------+------------------------------------------------------------------------+-----------+
| `MS_Zoning`          | Factor        | Identifies the general zoning classification of the sale.              |           |
+----------------------+---------------+------------------------------------------------------------------------+-----------+
| `Year_Built`         | Date          | Original construction date                                             |           |
+----------------------+---------------+------------------------------------------------------------------------+-----------+
| `Mas_Vnr_Area`       | Numeric       | Masonry veneer area in square feet                                     |           |
+----------------------+---------------+------------------------------------------------------------------------+-----------+
| `Remodeled`          | Factor        | Whether the house is modeled or not                                    | Remodel   |
+----------------------+---------------+------------------------------------------------------------------------+-----------+
| `Year_Remod_Add`     | Date          | Remodel date (same as construction date if no remodeling or additions) | Remodel   |
+----------------------+---------------+------------------------------------------------------------------------+-----------+
| `Half_Bath`          | Factor        | Half baths above grade                                                 | Bathroom  |
+----------------------+---------------+------------------------------------------------------------------------+-----------+
| `Full_Bath`          | Factor        | Full bathrooms above grade                                             | Bathroom  |
+----------------------+---------------+------------------------------------------------------------------------+-----------+
| `Exterior_2nd`       | Factor        | Exterior 2: Exterior covering on house (if more than one material)     | Exterior  |
+----------------------+---------------+------------------------------------------------------------------------+-----------+
| `Exter_Cond`         | Factor        | Evaluates the present condition of the material on the exterior        | Exterior  |
+----------------------+---------------+------------------------------------------------------------------------+-----------+
| `Total_Bsmt_SF`      | Numeric       | Total square feet of basement area                                     | Basement  |
+----------------------+---------------+------------------------------------------------------------------------+-----------+
| `Bsmt_Qual`          | Factor        | Evaluates the height of the basement                                   | Basement  |
+----------------------+---------------+------------------------------------------------------------------------+-----------+
| `Bsmt_Exposure`      | Factor        | Walkout or garden level walls                                          | Basement  |
+----------------------+---------------+------------------------------------------------------------------------+-----------+
| `Bsmt_Full_Bath`     | Factor        | Basement full bathrooms                                                | Basement  |
+----------------------+---------------+------------------------------------------------------------------------+-----------+
| `Garage_Area`        | Numeric       | Size of garage in square feet                                          | Garage    |
+----------------------+---------------+------------------------------------------------------------------------+-----------+
| `Garage_Cars`        | Factor        | Size of garage in car capacity                                         | Garage    |
+----------------------+---------------+------------------------------------------------------------------------+-----------+
| `Fireplaces`         | Factor        | Number of fireplaces                                                   | Fireplace |
+----------------------+---------------+------------------------------------------------------------------------+-----------+
| `Fireplace_Qu`       | Factor        | Fireplace quality                                                      | Fireplace |
+----------------------+---------------+------------------------------------------------------------------------+-----------+

: Variables Keep After Selection Algorithms

\newpage

## Diagnostics

Our preliminary multiple linear regression model has 22 variables. Before checking the diagnostics, we apply log transformation on `Sale_Price` as suggested from our **Exploratory Data Analysis**, and investigate the exceedingly large points we observed.

### Influence Points & Outliers

We identify observations with absolute standardized residuals greater than 2 and observations with hat-values greater than 3. Through checking their intersections, it can be concluded that the following observations are outliers and thus can be removed: `r outlier` .

Evidently, the author recommended "removing any houses with more than 4000 square feet from the dataset". [@Ames-Original] Based on this recommendation, we investigated the indices of the observations with general living area greater than 4000: `r which(ames$Gr_Liv_Area > 4000)` . Four out of five of these observations are outliers.

### Normality and Equal Variance Check

Since the assumption of independency has been satisfied according to the author's documentation, we check the normality and equal variance assumptions of our model after applying log transformation on the response and removing outliers. It can be observe from Figure 7 that the equal variance assumption is satisfied as most of the points are somewhat scattered around 0. However, based on Figure 8, the assumption of normality is not satisfied.

```{r fig.cap="Equal Variance", warning=FALSE}
plot(fit2, 1)
```

```{r fig.cap="Normality", warning=FALSE}
plot(fit2, 2)
```

### Transformation

Since we already apply log transformation on the response, we examine possible transformations on the numerical predictors. Based on the result below, we can apply square root transformation on `Total_Area`, and choose to apply no transformation on the rest of the predictors since their lambda values are close 1. After fitting the model again, we can observe Figure 9 and 10 and see that normality improved slightly but still heavy tailed. It is plausible that multiple linear regression is not appropriate to this dataset. However, we continue our analysis with this model for now.

```{r fig.cap="Transformation on the Predictor"}
summary(pred_tran)
```

```{r fig.cap="Equal Variacne Check on Transformed Model", warning=FALSE}
plot(fit3,1)
```

```{r fig.cap="Normality Check on Transformed Model",warning=FALSE}
plot(fit3,2)
```

\newpage

## Results

For the final model, we create dummy variables for all the categorical variables and keep the significant ones in the model. This resulted in 10 predictors in our final model. We check the assumptions of multiple linear regression again. It can be observed from Figure 11 that the model somewhat satisfies the equal variance assumption. However, normality improved somewhat but still do not satisfy the assumption as indicated in Figure 12.

```{r fig.cap="Summary Table of Our Final Model", fig.dim=c(10,10)}
summary(fit_final)
```

```{r fig.cap="final model diagnostic - Equal Variance",warning=FALSE}
plot(fit_final,1)
```

```{r fig.cap="final model diagnostic - Normality", warning=FALSE}
plot(fit_final,2)
```

\newpage

## Interpretation

Our final fitted model is:

Log(Sale_Price) = 3.214 - 0.0001 Total_Bsmt_SF + 0.0003 Garage_Area + 0.0258 Overall_Qual_Good - 0.303 Overall_Qual_Poor - 1.676 TotRms_AbvGrd_15 - 0.132 Bsmt_Qual_Typical- 0.101 Bsmt_Qual_Good - 0.101 Bsmt_Qual_No_Basement + 0.004 Year_Built + 0.036 sqrt(Total_Area)

From looking at the Added Variables Plots, we can conclude that `Garage_Area`, `Year_Built` and `sqrt(Total_Area)` are all positively associated with the response after controlling the effect of others, while `Overall_Qual_Poor`, `TotRms_AbvGrd_15`, `Total_Bsmt_SF` are negatively associated with the response after controlling the effects of other predictors. Other predictors that we find to be significant do not seem to be able to explain variability in the response individually. This could be due to overfitting.

```{r fig.cap="Added Variables Plot"}
avPlots(fit_final)
```

Now looking at the summary table of the fitted model, we have the following interpretation:

-   The predictors in this model collectively explain 81.7% of variability in the response, `Sale_Price`.

-   A 1 unit increase in total basement area in square feet, with the other predictors held fixed, is associated with an decrease in Sale Price by nearly 1 dollar.

-   A 1 unit increase in garage area in square feet, with the other predictors held fixed, is associated with an decrease in Sale Price by nearly 1 dollar.

-   Sale price of a property is positively associated with the good quality of overall material and finish of the house ,total area and the year it was built.

-   Sale price of a property is negatively associated with poor quality of overall material and finish of the house, number of the rooms if it's 15 and more, and basement quality.

-   Since `Year_Built` is a significant predictor, time series analysis should be done based on this finding. We do not preform a time series analysis as it is out of the scope of this project.

-   Overall, a house is more valuable if it has less than 15 rooms, no basement or smaller basement, good overall finish, bigger garage and total area.

\newpage

# Conclusion

We can conclude that in Ames, Iowa, the real states market values a house with bigger area and living area than basement. The fixed characteristics that influences the sale price of a house the most is the overall quality of the materials and finish, and the size of the living area. However, multiple linear regression may not be the best regression method for this dataset even though the model explains 81.6% of the variability in Sale Price. A more general regression technique is preferred since our model doesn't satisfy all the assumptions of a multiple linear regression model.

# Appendices

## R scripts

The report is rendered with the following scripts arranged in order of dependency:

-   `script.R` : the main script containing all of the data objects and model objects. Need to be run first. The script makes calls to three other scripts: `packages.R` , `functions.R` and `dummy.R`. The project RMD file automatically calls this script.

-   `figure_generator.R`: generate all of the figures used in the report and presentation.

-   `dummy.R` : creates dummy variables for all of the categorical variables. Called by `script.R`

-   `model.R`: runs forward, backward and stepwise AIC and BIC. Do not need to be called.

-   `packages.R` : contains all of the packages used in this project. Called by `packages.R`.

-   `functions.R` : contains helper functions. Called by `script.R` .

\newpage

# Reference
